<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ACE Architecture Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ─── Reset ─────────────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; }

    /* ─── Root layout: strict 50/50 split ───────────────────────────── */
    #app {
      display: flex;
      width: 100vw;
      height: 100vh;
    }

    /* ════════════════════════════════════════════════════════════════
       LEFT PANEL — white, architecture diagram
    ════════════════════════════════════════════════════════════════ */
    #left {
      width: 50%;
      height: 100vh;
      background: #ffffff;
      border-right: 1px solid #E8E8E8;
      display: flex;
      flex-direction: column;
      align-items: stretch;   /* children fill full width */
      overflow: hidden;
      position: relative;
    }

    /* Logo in upper-left corner */
    #logo {
      position: absolute;
      top: 14px;
      left: 16px;
      height: 28px;
      width: auto;
      z-index: 5;
    }

    /* Run Demo button row */
    #btn-row {
      flex-shrink: 0;
      display: flex;
      justify-content: center;
      padding: 18px 0 0;
    }

    #runDemoBtn {
      background: #00897B;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 28px;
      font-size: 14px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      letter-spacing: 0.015em;
      transition: background 0.18s, box-shadow 0.18s;
    }
    #runDemoBtn:hover   { background: #00796B; box-shadow: 0 4px 20px rgba(0,137,123,0.36); }
    #runDemoBtn:active  { background: #00695C; }
    #runDemoBtn:disabled { background: #80CBC4; cursor: not-allowed; box-shadow: none; }

    /* Diagram fills remaining height */
    #diagram {
      flex: 1;
      position: relative;           /* arrow SVG is absolute inside here */
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
      padding: 10px 16px 14px;
      min-height: 0;
    }

    /* Arrow overlay — sits behind boxes */
    #arrows {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: visible;
    }

    /* ─── Layer group ─────────────────────────────────────────────── */
    .layer {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .layer-label {
      font-size: 11px;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 6px;
      white-space: nowrap;
    }

    .row {
      display: flex;
      gap: 6px;
      width: 100%;
    }

    /* Gap between top and bottom sub-rows inside Layer 2 */
    .row + .row { margin-top: 18px; }

    /* ─── Box ─────────────────────────────────────────────────────── */
    .box {
      flex: 1;
      min-width: 0;
      background: #F7F7F7;
      border: 1.5px solid #D0D0D0;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      padding: 8px 6px;
      min-height: 42px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .box span.lbl {
      font-size: 12px;
      font-weight: 600;
      color: #333;
      line-height: 1.3;
    }

    .box span.tag {
      display: block;
      font-size: 8.5px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: #C0C0C0;
      margin-top: 3px;
      font-style: normal;
    }

    /* Left-border accents */
    .teal   { border-left: 3px solid #00897B; }
    .blue   { border-left: 3px solid #1E88E5; }
    .amber  { border-left: 3px solid #F59E0B; }

    /* Sunset / deprecated style */
    .sunset               { border: 1.5px dashed #CCCCCC !important; }
    .sunset span.lbl      { color: #AAAAAA; font-style: italic; }

    /* Active highlight (used by demo runner) */
    .box {
      transition: box-shadow 0.4s ease, border-color 0.4s ease;
    }
    .box.active {
      box-shadow: 0 0 0 3px #00897B, 0 0 20px rgba(0,137,123,0.4);
      border-color: #00897B !important;
      transition: all 0.3s ease;
    }

    /* ════════════════════════════════════════════════════════════════
       RIGHT PANEL — sky aesthetic only, no chat widget
    ════════════════════════════════════════════════════════════════ */
    #right {
      width: 50%;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    /* Background image: full width visible, overflow clips bottom */
    #sky-grad {
      position: absolute; inset: 0;
      background: url('webpage_image_long.png') top center / 100% auto no-repeat;
      background-color: #f5f5f5;
    }

    /* ════════════════════════════════════════════════════════════════
       CHAT WIDGET — overlaid on the sky panel
    ════════════════════════════════════════════════════════════════ */
    #chat-container {
      position: absolute;
      top: 50%; right: 24px;
      transform: translateY(-50%);
      width: 370px;
      max-height: 70vh;
      display: flex;
      flex-direction: column;
      z-index: 10;
      pointer-events: auto;
    }

    #chat-header {
      background: rgba(0,137,123,0.92);
      color: #fff;
      padding: 14px 18px;
      border-radius: 14px 14px 0 0;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.01em;
      backdrop-filter: blur(8px);
    }

    #chat-messages {
      flex: 1;
      overflow-y: auto;
      background: rgba(255,255,255,0.95);
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 260px;
      max-height: 52vh;
      backdrop-filter: blur(8px);
    }

    #chat-footer {
      background: rgba(245,245,245,0.95);
      border-radius: 0 0 14px 14px;
      padding: 12px 14px;
      font-size: 12px;
      color: #999;
      text-align: center;
      backdrop-filter: blur(8px);
    }

    .chat-msg {
      max-width: 85%;
      padding: 10px 14px;
      border-radius: 14px;
      font-size: 13px;
      line-height: 1.5;
      opacity: 0;
      animation: chatFadeIn 0.35s ease forwards;
    }

    @keyframes chatFadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .chat-msg.assistant {
      background: #E0F2F1;
      color: #1a1a1a;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    .chat-msg.customer {
      background: #00897B;
      color: #fff;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    /* Typing indicator */
    .typing-indicator {
      align-self: flex-start;
      display: flex;
      gap: 4px;
      padding: 10px 16px;
      background: #E0F2F1;
      border-radius: 14px;
      border-bottom-left-radius: 4px;
      opacity: 0;
      animation: chatFadeIn 0.25s ease forwards;
    }
    .typing-indicator span {
      width: 7px; height: 7px;
      background: #80CBC4;
      border-radius: 50%;
      animation: typingBounce 1.2s infinite;
    }
    .typing-indicator span:nth-child(2) { animation-delay: 0.15s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.3s; }
    @keyframes typingBounce {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30%           { transform: translateY(-5px); opacity: 1; }
    }

    /* Freshdesk badge */
    #freshdesk-badge {
      display: none;
      margin-top: 8px;
      text-align: center;
      opacity: 0;
    }
    #freshdesk-badge.visible {
      display: block;
      animation: chatFadeIn 0.4s ease forwards;
    }
    #freshdesk-badge span {
      display: inline-block;
      background: rgba(0,137,123,0.12);
      color: #00897B;
      font-size: 12px;
      font-weight: 600;
      padding: 6px 16px;
      border-radius: 20px;
      border: 1px solid rgba(0,137,123,0.25);
    }

    /* ─── Next / Restart button ────────────────────────────────── */
    #nextBtn {
      display: none;
      position: absolute;
      bottom: 28px;
      right: 28px;
      background: #00897B;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 22px;
      font-size: 14px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      z-index: 20;
      letter-spacing: 0.01em;
      transition: background 0.18s, box-shadow 0.18s;
    }
    #nextBtn:hover:not(:disabled) {
      background: #00796B;
      box-shadow: 0 4px 16px rgba(0,137,123,0.4);
    }
    #nextBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
<div id="app">

  <!-- ══════════════════════════════════════════════════════════
       LEFT PANEL — architecture diagram
  ══════════════════════════════════════════════════════════════ -->
  <div id="left">

    <img id="logo" src="logo.png" alt="Satair logo">

    <div id="btn-row">
      <button id="runDemoBtn">&#9654; Run Demo</button>
    </div>

    <div id="diagram">

      <!-- Arrows drawn by JS into this SVG -->
      <svg id="arrows"></svg>

      <!-- ╔══════════════════════════════════════╗
           ║  LAYER 1 — INPUTS & TOUCHPOINTS      ║
           ╚══════════════════════════════════════╝ -->
      <div class="layer">
        <div class="layer-label">Inputs &amp; Touchpoints</div>
        <div class="row">
          <div class="box teal"  id="node-satair-market">
            <span class="lbl">Satair Market</span>
          </div>
          <div class="box blue"  id="node-self-service-portal">
            <span class="lbl">Self-Service Portal</span>
          </div>
          <div class="box"       id="node-email-intake">
            <span class="lbl">Email Intake</span>
          </div>
          <div class="box teal"  id="node-ai-case-management">
            <span class="lbl">AI Case Management</span>
          </div>
          <div class="box teal"  id="node-human-in-the-loop">
            <span class="lbl">Human in the Loop</span>
          </div>
        </div>
      </div>

      <!-- ╔══════════════════════════════════════╗
           ║  LAYER 2 — AI ORCHESTRATION          ║
           ╚══════════════════════════════════════╝ -->
      <div class="layer">
        <div class="layer-label">AI Orchestration</div>
        <!-- top sub-row: orchestration core -->
        <div class="row">
          <div class="box amber" id="node-session-manager">
            <span class="lbl">Session Manager</span>
          </div>
          <div class="box amber" id="node-ace-ai-orchestrator">
            <span class="lbl">ACE AI Orchestrator</span>
          </div>
          <div class="box amber" id="node-llm-service">
            <span class="lbl">LLM Service</span>
          </div>
        </div>
        <!-- bottom sub-row: tool belt -->
        <div class="row">
          <div class="box amber" id="node-session-state">
            <span class="lbl">Session State</span>
          </div>
          <div class="box amber" id="node-ticket-tool">
            <span class="lbl">Ticket Tool</span>
          </div>
          <div class="box amber" id="node-sap-lookup-tool">
            <span class="lbl">SAP Lookup Tool</span>
          </div>
          <div class="box amber" id="node-knowledge-tool">
            <span class="lbl">Knowledge Tool</span>
          </div>
          <div class="box amber" id="node-case-history-tool">
            <span class="lbl">Case History Tool</span>
          </div>
          <div class="box amber" id="node-response-draft-tool">
            <span class="lbl">Response Draft Tool</span>
          </div>
        </div>
      </div>

      <!-- ╔══════════════════════════════════════╗
           ║  LAYER 3 — INTEGRATION LAYER         ║
           ╚══════════════════════════════════════╝ -->
      <div class="layer">
        <div class="layer-label">Integration Layer</div>
        <div class="row">
          <div class="box"        id="node-case-management-adapter">
            <span class="lbl">Case Management Adapter</span>
          </div>
          <div class="box"        id="node-sap-adapters">
            <span class="lbl">SAP Adapters</span>
          </div>
          <div class="box"        id="node-knowledge-doc-adapters">
            <span class="lbl">Knowledge &amp; Doc Adapters</span>
          </div>
          <div class="box sunset" id="node-llm-adapter">
            <span class="lbl">LLM Adapter</span>
            <span class="tag">sunset</span>
          </div>
          <div class="box sunset" id="node-legacy-automation">
            <span class="lbl">Legacy Automation</span>
            <span class="tag">sunset</span>
          </div>
        </div>
      </div>

      <!-- ╔══════════════════════════════════════╗
           ║  LAYER 4 — CORE SYSTEMS              ║
           ╚══════════════════════════════════════╝ -->
      <div class="layer">
        <div class="layer-label">Core Systems</div>
        <div class="row">
          <div class="box"        id="node-freshdesk">
            <span class="lbl">Freshdesk</span>
          </div>
          <div class="box"        id="node-sap-rpr">
            <span class="lbl">SAP-RPR</span>
          </div>
          <div class="box"        id="node-sap-ap1">
            <span class="lbl">SAP-AP1</span>
          </div>
          <div class="box"        id="node-sap-cc">
            <span class="lbl">SAP-CC</span>
          </div>
          <div class="box"        id="node-symbio">
            <span class="lbl">Symbio</span>
          </div>
          <div class="box sunset" id="node-lilly">
            <span class="lbl">LILLY</span>
            <span class="tag">to be replaced</span>
          </div>
        </div>
      </div>

    </div><!-- /#diagram -->
  </div><!-- /#left -->

  <!-- ══════════════════════════════════════════════════════════
       RIGHT PANEL — dramatic sky aesthetic, no chat
  ══════════════════════════════════════════════════════════════ -->
  <div id="right">
    <div id="sky-grad"></div>

    <!-- Chat widget -->
    <div id="chat-container" style="display:none;">
      <div id="chat-header">Satair Customer Assistant</div>
      <div id="chat-messages"></div>
      <div id="chat-footer">Powered by ACE AI</div>
      <div id="freshdesk-badge"><span></span></div>
    </div>

    <!-- Next / Restart button -->
    <button id="nextBtn">Next &#9654;</button>
  </div><!-- /#right -->

</div><!-- /#app -->

<script>
// ══════════════════════════════════════════════════════════════════════════
//  ARROW DRAWING
// ══════════════════════════════════════════════════════════════════════════

function drawArrows() {
  const svg  = document.getElementById('arrows');
  const wrap = document.getElementById('diagram');

  svg.innerHTML = '';
  const cr = wrap.getBoundingClientRect();
  svg.setAttribute('width',   cr.width);
  svg.setAttribute('height',  cr.height);
  svg.setAttribute('viewBox', `0 0 ${cr.width} ${cr.height}`);

  const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
  defs.innerHTML = `
    <marker id="arr" viewBox="0 0 8 6" markerWidth="8" markerHeight="6"
            refX="8" refY="3" orient="auto" markerUnits="userSpaceOnUse">
      <polygon points="0 0, 8 3, 0 6" fill="#B0B0B0" opacity="0.75"/>
    </marker>`;
  svg.appendChild(defs);

  function box(id) {
    const el = document.getElementById(id);
    if (!el) return null;
    const r = el.getBoundingClientRect();
    const x = r.left - cr.left;
    const y = r.top  - cr.top;
    return { cx: x + r.width/2, cy: y + r.height/2,
             top: y, bot: y + r.height, left: x, right: x + r.width };
  }

  function path(d, dashed) {
    const el = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    el.setAttribute('d', d);
    el.setAttribute('stroke', '#B0B0B0');
    el.setAttribute('stroke-width', '1.5');
    el.setAttribute('stroke-opacity', '0.5');
    el.setAttribute('fill', 'none');
    el.setAttribute('marker-end', 'url(#arr)');
    if (dashed) el.setAttribute('stroke-dasharray', '5 3');
    svg.appendChild(el);
  }

  function down(fromId, toId, dashed) {
    const a = box(fromId), b = box(toId);
    if (!a || !b) return;
    const mid = (a.bot + b.top) / 2;
    path(`M ${a.cx},${a.bot} C ${a.cx},${mid} ${b.cx},${mid} ${b.cx},${b.top}`, dashed);
  }

  function right(fromId, toId) {
    const a = box(fromId), b = box(toId);
    if (!a || !b) return;
    path(`M ${a.right},${a.cy} L ${b.left},${b.cy}`);
  }

  function bidir(aId, bId) {
    const a = box(aId), b = box(bId);
    if (!a || !b) return;
    const off = 3.5;
    path(`M ${a.right},${a.cy - off} L ${b.left},${b.cy - off}`);
    path(`M ${b.left},${b.cy + off} L ${a.right},${a.cy + off}`);
  }

  // Layer 1 → ACE AI Orchestrator
  ['node-satair-market', 'node-self-service-portal', 'node-email-intake',
   'node-ai-case-management', 'node-human-in-the-loop']
    .forEach(id => down(id, 'node-ace-ai-orchestrator'));

  bidir('node-session-manager', 'node-ace-ai-orchestrator');
  right('node-ace-ai-orchestrator', 'node-llm-service');

  ['node-session-state', 'node-ticket-tool', 'node-sap-lookup-tool',
   'node-knowledge-tool', 'node-case-history-tool', 'node-response-draft-tool']
    .forEach(id => down('node-ace-ai-orchestrator', id));

  down('node-ticket-tool',         'node-case-management-adapter');
  down('node-sap-lookup-tool',     'node-sap-adapters');
  down('node-knowledge-tool',      'node-knowledge-doc-adapters');
  down('node-case-history-tool',   'node-case-management-adapter');
  down('node-response-draft-tool', 'node-llm-adapter');

  down('node-case-management-adapter', 'node-freshdesk');
  down('node-sap-adapters',            'node-sap-rpr');
  down('node-sap-adapters',            'node-sap-ap1');
  down('node-sap-adapters',            'node-sap-cc');
  down('node-knowledge-doc-adapters',  'node-symbio');
  down('node-llm-adapter',             'node-lilly');
  down('node-legacy-automation', 'node-freshdesk', true);
}

let _rt;
window.addEventListener('resize', () => { clearTimeout(_rt); _rt = setTimeout(drawArrows, 60); });
window.addEventListener('load', () => requestAnimationFrame(drawArrows));


// ══════════════════════════════════════════════════════════════════════════
//  DEMO LOGIC
// ══════════════════════════════════════════════════════════════════════════

(function() {
  const runBtn    = document.getElementById('runDemoBtn');
  const nextBtn   = document.getElementById('nextBtn');
  const chatBox   = document.getElementById('chat-container');
  const msgArea   = document.getElementById('chat-messages');
  const badge     = document.getElementById('freshdesk-badge');

  let demoActive  = false;
  let currentStep = -1;
  let animating   = false;   // true while a step sequence is playing

  // ─── Utility: promise-based delay ──────────────────────────────────────
  function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

  // ─── Highlight helpers ─────────────────────────────────────────────────
  function highlightNodes(ids) {
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.classList.add('active');
    });
  }

  function clearAllHighlights() {
    document.querySelectorAll('.box.active').forEach(el => el.classList.remove('active'));
  }

  // ─── Chat message helpers ──────────────────────────────────────────────
  function addMessage(text, role) {
    const div = document.createElement('div');
    div.className = 'chat-msg ' + role;
    div.textContent = text;
    msgArea.appendChild(div);
    msgArea.scrollTop = msgArea.scrollHeight;
    return div;
  }

  function showTyping() {
    const div = document.createElement('div');
    div.className = 'typing-indicator';
    div.innerHTML = '<span></span><span></span><span></span>';
    div.id = 'typing';
    msgArea.appendChild(div);
    msgArea.scrollTop = msgArea.scrollHeight;
    return div;
  }

  function removeTyping() {
    const el = document.getElementById('typing');
    if (el) el.remove();
  }

  // ─── Architecture animation: standard customer message cycle ───────────
  // Satair Market → ACE AI Orchestrator → LLM Service + Session Manager
  //   → Ticket Tool → Case Management Adapter → Freshdesk → typing → response
  // Highlights accumulate and persist until the next "Next" click clears them.
  async function runArchCycle(responseText) {
    await wait(300);
    highlightNodes(['node-satair-market']);

    await wait(600);
    highlightNodes(['node-ace-ai-orchestrator']);

    await wait(600);
    highlightNodes(['node-llm-service', 'node-session-manager']);

    await wait(600);
    highlightNodes(['node-ticket-tool']);

    await wait(600);
    highlightNodes(['node-case-management-adapter']);

    await wait(600);
    highlightNodes(['node-freshdesk']);

    await wait(700);
    showTyping();

    await wait(800);
    removeTyping();
    addMessage(responseText, 'assistant');
  }

  // ─── Final step: show confirmation message, badge, and Human in the Loop ──
  async function runFinalSequence() {
    await wait(600);

    // Show final assistant message
    addMessage(
      '\u2713 Your defect report has been filed and a replacement is being arranged. A service agent will follow up with the return shipping details shortly. Is there anything else I can help you with?',
      'assistant'
    );

    // Show badge
    badge.querySelector('span').textContent = '\u2713 Defect report created in Freshdesk';
    badge.classList.add('visible');

    // Clear all highlights, then light up Human in the Loop
    await wait(800);
    clearAllHighlights();
    await wait(400);
    highlightNodes(['node-human-in-the-loop']);
  }

  // ─── Step definitions ──────────────────────────────────────────────────
  const STEPS = [
    // Step 0: greeting (triggered by Run Demo — no Next click needed)
    {
      action: async function() {
        addMessage(
          "Hello! I'm your Satair Customer Assistant. How can I help you today?",
          'assistant'
        );
      }
    },
    // Step 1
    {
      action: async function() {
        await wait(300);
        addMessage(
          "Hi, we received a hydraulic pump (PN: AH-65042) for our A320 and it's showing signs of external leakage. We need to report the defect.",
          'customer'
        );
        await wait(350);
        await runArchCycle(
          "I'm sorry to hear that. I can help you report this defect. Could you please provide your Customer ID and the order number for this part?"
        );
      }
    },
    // Step 2
    {
      action: async function() {
        await wait(300);
        addMessage("Sure, it's CUST-99121. The part was from order 457892.", 'customer');
        await wait(350);
        await runArchCycle(
          "Thank you, I've noted those details. Could you describe the leakage \u2014 is it at the inlet port, outlet port, or the shaft seal area?"
        );
      }
    },
    // Step 3 (final)
    {
      action: async function() {
        await wait(300);
        addMessage("It's leaking from the shaft seal. We noticed it during the incoming inspection before installation.", 'customer');
        await wait(350);
        await runArchCycle(
          "Understood \u2014 shaft seal leakage on PN AH-65042, caught at incoming inspection. I'll create a defect report and arrange a replacement. Let me open a ticket for you now."
        );
        await runFinalSequence();
      }
    }
  ];

  const LAST_STEP = STEPS.length - 1;

  // ─── Next button click ─────────────────────────────────────────────────
  nextBtn.addEventListener('click', async function() {
    if (animating) return;

    // If at restart state, reset the demo
    if (currentStep > LAST_STEP - 1 && nextBtn.textContent === 'Restart') {
      resetDemo();
      return;
    }

    currentStep++;
    if (currentStep > LAST_STEP) return;

    animating = true;
    nextBtn.disabled = true;

    // Fade out previous highlights
    clearAllHighlights();

    await STEPS[currentStep].action();

    animating = false;
    nextBtn.disabled = false;

    // After final step, change to Restart
    if (currentStep >= LAST_STEP) {
      nextBtn.textContent = 'Restart';
    }
  });

  // ─── Run Demo button ──────────────────────────────────────────────────
  runBtn.addEventListener('click', function() {
    if (demoActive) {
      resetDemo();
      return;
    }
    startDemo();
  });

  async function startDemo() {
    demoActive   = true;
    currentStep  = 0;
    animating    = true;

    // Show chat container
    chatBox.style.display = 'flex';
    msgArea.innerHTML = '';
    badge.classList.remove('visible');
    badge.style.display = '';
    clearAllHighlights();

    // Run Step 0 (greeting)
    await STEPS[0].action();

    animating = false;

    // Show Next button
    nextBtn.textContent = 'Next \u25B6';
    nextBtn.style.display = 'block';
    nextBtn.disabled = false;
  }

  function resetDemo() {
    demoActive  = false;
    currentStep = -1;
    animating   = false;

    // Clear everything instantly
    msgArea.innerHTML = '';
    clearAllHighlights();
    badge.classList.remove('visible');
    badge.style.display = '';
    nextBtn.style.display = 'none';
    nextBtn.disabled = false;

    // Wait 400ms then restart
    setTimeout(function() {
      startDemo();
    }, 400);
  }
})();
</script>
</body>
</html>
